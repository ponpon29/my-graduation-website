<div class="flex flex-col min-h-screen pt-16">
  <h1 class="text-center text-4xl font-bold">map</h1> 
  <div id="map" class="flex-grow"></div>
</div>

<style>
#map {
  height: 600px;
  width: 100%;
}
</style>

<script>
let map;
const shops = <%= raw @shops.to_json %>;

function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 33.590188, lng: 130.420685},
    zoom: 17,
  });

  const initialMarker = new google.maps.Marker({
    position: {lat: 33.590188, lng: 130.420685},
    map: map,
    title: "博多駅"
  });

  shops.forEach(shop => {
    const lat = parseFloat(shop.latitude);
    const lng = parseFloat(shop.longitude);

    const marker = new google.maps.Marker({
      position: { lat: lat, lng: lng },
      map: map,
      title: shop.name
    });

    const infoWindow = new google.maps.InfoWindow({
      content: `<div><h3>${shop.name}</h3><p>評価: ${shop.rating || '評価なし'}</p></div>`
    });

    marker.addListener('click', function() {
      infoWindow.open(map, marker);
    });
  });
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['MAPS_API_KEY'] %>&callback=initMap" async defer></script>

<meta name="apple-mobile-web-app-capable" content="yes">
